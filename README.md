# gobgp_inet_updater

It is a common requirement for network engineers to try sending a copy or more of the current internet routing table to a routing device under test, this is usually done to test convergence, FIB capacity, etc..

The purpose of this repo is to have a quick way to send full internet routing table copy to a networking device under test, the tool relies on two main components:

* [GoBGP](https://github.com/osrg/gobgp), This acts as a BGP speaker running on Linux hosts (either natively or inside a container, etc.), assumed to be connected to the device under test
* [pfx_parser](https://github.com/mmareimorsy/pfx_parser), This is a tool that creates a JSON file containing IPv4 & IPv6 prefixes along with their BGP path attributes.

## How to setup

1) [GoBGP](https://github.com/osrg/gobgp) has to be installed somewhere on a Linux based host (or a container) before you can use ```gobgp_client.py``` , the reason why is that ```gobgp_client.py``` connects to GoBGP over GRPC, the GoBGP server side of the GRPC connection is assumed to be on the localhost (although nothing prevents modifying ```gobgp_client.py``` to connect over remote connections instead of localhost)

2) Install requirements as below

```
python3 -m pip install -r requirements.txt
```

3) IPv4 & IPv6 RIB in JSON format are required, those can be generated by running [pfx_parser.py](https://github.com/mmareimorsy/pfx_parser) against desired MRT file for the desired copy of internet routing table (Note: for a ready to use example JSON files instead of running pfx_parser, JSON files can be downloaded from [Gdrive Here](https://drive.google.com/drive/folders/1-2CZHaXhaQ_j9WdbaT3KqjPMG-FWzeob?usp=sharing))

## How to use

You can use help in CLI available with the tool as below 


```
./gobgp_client.py -h
usage: --help to list available commands

GoBGP client

options:
  -h, --help            show this help message and exit
  --json_rib JSON_RIB [JSON_RIB ...]
                        name of json files with BGP updates to send
  --num_prefixes NUM_PREFIXES
                        Number of prefixes to send across all files
```

Arguments available:

* ```--json_rib``` : This is a mandatory list of json files where you have the RIBs stored, you can pass one or more files as required for the tool to start parsing one by one
* ```--num_prefixes```: Optional argument, if there is a requirement to send only specific number of prefixes (ex: 1000 prefix only), passing this argument will cause the script to abort after sending the desired number of prefixes

Example:

```
./gobgp_client.py --json_rib ipv4_rib.json ipv6_rib.json --num_prefixes 100
INFO :: 05/21/2023 09:29:32 PM :: Processing rib file ipv4_rib.json
INFO :: 05/21/2023 09:29:33 PM :: Processing rib file ipv6_rib.json
INFO :: 05/21/2023 09:29:32 PM :: Sent 100 prefixes out of a total of 100 expected prefixes
```
